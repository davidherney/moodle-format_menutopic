define("format_menutopic/menutopictree",["exports","jquery","core/str","core/notification","core/modal_factory","core/modal_events","core/log"],(function(_exports,_jquery,_str,_notification,_modal_factory,_modal_events,_log){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * JavaScript library for the menutopic course format.
   *
   * @copyright 2018 David Herney Bernal - cirano
   * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=_interopRequireDefault(_jquery),_notification=_interopRequireDefault(_notification),_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events),_log=_interopRequireDefault(_log);var treeController={codeSelector:"#id_treecode",containerSelector:"#treecontainer"},s=[],$editWindow=null,$currentNode=null;treeController.runAction=function(action,$node){var $group,$prev;switch(action){case"toleft":var $parent=$node.parents("li:first");$parent.after($node),0==($group=$parent.children("ul")).children()&&$group.remove();break;case"toright":0==($group=($prev=$node.prev("li")).children("ul")).length&&($group=(0,_jquery.default)('<ul role="group"></ul>'),$prev.append($group)),$group.append($node);break;case"todown":$node.next("li").after($node);break;case"toup":($prev=$node.prev("li")).before($node);break;case"toremove":_notification.default.confirm(s.delete,s.actiondeleteconfirm_sheet_sheetedit,s.yes,s.no,(function(){$node.remove()}));break;case"toadd":var obj={name:s.new,topicnumber:0,url:"",target:""},$newNode=treeController.newTreeNode(obj,"");$newNode.find("[data-action]").on("click",(function(){var $this=(0,_jquery.default)(this);treeController.runAction($this.attr("data-action"),$this.parent().parent())})),0==($group=$node.children("ul")).length&&($group=(0,_jquery.default)('<ul role="group"></ul>'),$node.append($group)),$group.append($newNode);break;case"toedit":if($currentNode=$node,$editWindow){var $modalBody=$editWindow.getBody();$modalBody.find("#name_text").val($node.find("input").val()),$modalBody.find("#select_topic").val($node.data("topic")),$modalBody.find("#url_text").val($node.data("url")),$modalBody.find("#select_target").val($node.data("target")),treeController.changeTopic(),$editWindow.setTitle(s.update),$editWindow.show()}}},treeController.newTreeNode=function(obj){var name=obj.name.replace(/"/g,"&quot;"),$node=(0,_jquery.default)('<li><input value="'+name+'"/><div class="operations"><span data-action="toedit">&#9997;</span><span data-action="toleft">&larr;</span><span data-action="toright">&rarr;</span><span data-action="toup">&uarr;</span><span data-action="todown">&darr;</span><span data-action="toremove">&#10008;</span><span data-action="toadd">&#10010;</span></div></li>');return $node.data("topic",obj.topicnumber),$node.data("url",obj.url),$node.data("target",obj.target),$node},treeController.loadTreeAria=function(){var $controlContainer=(0,_jquery.default)(treeController.codeSelector);if($controlContainer.length>0){var jsonString=$controlContainer.val();try{var jsonObject=JSON.parse(jsonString);if(jsonObject.topics&&jsonObject.topics.length>0){for(var createNode=function($nodeRoot,obj){var isparent=!1;obj.subtopics&&obj.subtopics.length>0&&(isparent=!0);var $node=treeController.newTreeNode(obj);if($nodeRoot.append($node),isparent){var $group=(0,_jquery.default)("<ul></ul>");$node.append($group);for(var i=0;i<obj.subtopics.length;i++)createNode($group,obj.subtopics[i])}},$treeAria=(0,_jquery.default)('<ul class="tree root-level"></ul>'),i=0;i<jsonObject.topics.length;i++)createNode($treeAria,jsonObject.topics[i]);var $operations=(0,_jquery.default)('<div class="operations main"><span data-action="toadd">&#10010;</span></div>');(0,_jquery.default)(treeController.containerSelector).append($operations),(0,_jquery.default)(treeController.containerSelector).append($treeAria),(0,_jquery.default)(treeController.containerSelector).find("[data-action]").on("click",(function(){var $this=(0,_jquery.default)(this);treeController.runAction($this.attr("data-action"),$this.parent().parent())}))}return!0}catch(e){return(0,_str.get_string)("error","core").then((str=>{_notification.default.alert(str,e)})),!1}}return!1},treeController.changeTopic=function(){var $modalBody=$editWindow.getBody();""!==$modalBody.find("#select_topic").val()?$modalBody.find("#url_text").attr("disabled","disabled"):$modalBody.find("#url_text").removeAttr("disabled")},treeController.saveTreeConfig=function(){var treecode={topics:[]};treecode.topics=treeController.treeNode2Object((0,_jquery.default)(treeController.containerSelector)),treecode.topics.length>0?(0,_jquery.default)(treeController.codeSelector).val(JSON.stringify(treecode)):(0,_jquery.default)(treeController.codeSelector).val("")},treeController.treeNode2Object=function($nodeRoot){var nodes=[];return $nodeRoot.children("ul").children("li").each((function(key,node){var $node=(0,_jquery.default)(node),onenode={name:$node.find("input").val(),subtopics:treeController.treeNode2Object($node),topicnumber:$node.data("topic"),url:$node.data("url"),target:$node.data("target")};nodes[nodes.length]=onenode})),nodes};_exports.init=()=>{var loaded=treeController.loadTreeAria(),strings=[];if(strings.push({key:"actiondeleteconfirm_sheet_sheetedit",component:"format_menutopic"}),strings.push({key:"new",component:"core"}),strings.push({key:"delete",component:"core"}),strings.push({key:"yes",component:"core"}),strings.push({key:"no",component:"core"}),strings.push({key:"update",component:"core"}),strings.forEach((one=>{s[one.key]=one.key})),(0,_str.get_strings)(strings).then((function(results){var pos=0;return strings.forEach((one=>{s[one.key]=results[pos],pos++})),!0})).fail((function(e){_log.default.debug("Error loading strings"),_log.default.debug(e)})),loaded){var editBody=(0,_jquery.default)("#editsheetform").html();_modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL,title:s.update,body:editBody}).done((function(modal){var $modalBody=modal.getBody();$modalBody.find("#select_topic").on("change",treeController.changeTopic),modal.getRoot().on(_modal_events.default.save,(function(){$currentNode.find(">input").val($modalBody.find("#name_text").val()),$currentNode.data("topic",$modalBody.find("#select_topic").val()),$currentNode.data("url",$modalBody.find("#url_text").val()),$currentNode.data("target",$modalBody.find("#select_target").val())})),$editWindow=modal})),(0,_jquery.default)("#id_submitbutton").on("click",treeController.saveTreeConfig)}}}));

//# sourceMappingURL=menutopictree.min.js.map